# 01. 專案初始化與環境準備
## 線上圖書借閱系統 - Spring Boot 學習筆記

---

### 📋 **學習目標**
- 了解Spring Boot專案的基本結構
- 理解Maven專案配置（pom.xml）
- 掌握Docker開發環境的設置
- 建立完整的開發環境

---

## 🎯 **為什麼要這樣做？**

### **1. 為什麼使用Spring Boot？**
Spring Boot是一個**約定優於配置**的框架，它：
- ✅ **自動配置**：根據依賴自動配置應用程式
- ✅ **內建伺服器**：不需要額外配置Tomcat
- ✅ **生產就緒**：內建監控、健康檢查等功能
- ✅ **快速開發**：減少樣板程式碼

### **2. 為什麼使用Maven？**
Maven是Java的**建置工具**，它：
- ✅ **依賴管理**：自動下載和管理套件
- ✅ **專案結構**：標準化的專案目錄結構
- ✅ **建置生命週期**：編譯、測試、打包、部署
- ✅ **插件生態**：豐富的插件支援

### **3. 為什麼使用Docker？**
Docker提供**容器化**環境，它：
- ✅ **環境一致性**：避免「在我電腦上能跑」的問題
- ✅ **快速部署**：一鍵啟動完整環境
- ✅ **隔離性**：不同專案使用不同環境
- ✅ **可移植性**：在任何地方都能運行

---

## 🏗️ **第一步：建立Maven專案配置（pom.xml）**

### **什麼是pom.xml？**
`pom.xml`是Maven專案的**核心配置文件**，定義了：
- 專案基本資訊（名稱、版本、描述）
- 依賴套件清單
- 建置配置
- 插件設定

### **pom.xml結構解析**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <!-- 繼承Spring Boot父專案 -->
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.2.0</version>
        <relativePath/>
    </parent>

    <!-- 專案基本資訊 -->
    <groupId>com.library</groupId>
    <artifactId>library-management-system</artifactId>
    <version>1.0.0</version>
    <name>Library Management System</name>
    <description>線上圖書借閱系統 - Spring Boot專案</description>
```

### **重要依賴套件說明**

#### **Spring Boot Starters**
```xml
<!-- Web功能：提供RESTful API -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>

<!-- 資料庫操作：JPA/Hibernate -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>

<!-- 安全認證：Spring Security -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

**什麼是Starter？**
- Starter是Spring Boot的**自動配置套件**
- 包含相關功能的所有依賴
- 自動配置相關的Bean和設定

#### **資料庫相關**
```xml
<!-- PostgreSQL驅動 -->
<dependency>
    <groupId>org.postgresql</groupId>
    <artifactId>postgresql</artifactId>
    <scope>runtime</scope>
</dependency>

<!-- 測試用記憶體資料庫 -->
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>test</scope>
</dependency>
```

#### **JWT認證**
```xml
<!-- JWT API -->
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-api</artifactId>
    <version>${jjwt.version}</version>
</dependency>
```

**什麼是JWT？**
- JWT（JSON Web Token）是**無狀態認證**方式
- 用戶登入後獲得Token，後續請求帶上Token
- 不需要在伺服器端儲存Session

---

## 🏗️ **第二步：建立主應用程式類別**

### **檔案位置：** `src/main/java/com/library/LibraryManagementApplication.java`

```java
package com.library;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.scheduling.annotation.EnableScheduling;

/**
 * 線上圖書借閱系統 - 主應用程式類別
 */
@SpringBootApplication
@EnableScheduling
public class LibraryManagementApplication {

    public static void main(String[] args) {
        SpringApplication.run(LibraryManagementApplication.class, args);
    }
}
```

### **重要註解說明**

#### **@SpringBootApplication**
- 這是**組合註解**，包含：
  - `@Configuration`：標記為配置類別
  - `@EnableAutoConfiguration`：啟用自動配置
  - `@ComponentScan`：掃描組件

#### **@EnableScheduling**
- 啟用**排程功能**
- 用於定時任務（如到期通知）

### **main方法的作用**
```java
SpringApplication.run(LibraryManagementApplication.class, args);
```
- 啟動Spring Boot應用程式
- 載入所有配置
- 啟動內建伺服器（預設8080端口）

---

## 🏗️ **第三步：建立應用程式配置**

### **檔案位置：** `src/main/resources/application.yml`

### **配置結構解析**

#### **資料庫配置**
```yaml
spring:
  datasource:
    url: jdbc:postgresql://postgres:5432/library
    username: postgres
    password: password
    driver-class-name: org.postgresql.Driver
```

**配置說明：**
- `url`：資料庫連線字串
- `postgres`：Docker容器名稱
- `5432`：PostgreSQL預設端口
- `library`：資料庫名稱

#### **JPA配置**
```yaml
jpa:
  hibernate:
    ddl-auto: validate  # 驗證資料庫結構
  show-sql: false       # 不顯示SQL語句
  properties:
    hibernate:
      dialect: org.hibernate.dialect.PostgreSQLDialect
```

**ddl-auto選項：**
- `validate`：驗證資料庫結構與Entity是否一致
- `create`：每次啟動都重新建立表
- `update`：更新表結構
- `create-drop`：啟動時建立，關閉時刪除

#### **JWT配置**
```yaml
jwt:
  secret: library-management-system-secret-key-2024-very-long-and-secure
  expiration: 86400000  # 24小時 (毫秒)
```

#### **API文件配置**
```yaml
springdoc:
  swagger-ui:
    path: /swagger-ui.html
  info:
    title: 線上圖書借閱系統 API
    description: 提供圖書借閱、還書、書籍管理等功能的RESTful API
```

---

## 🐳 **第四步：Docker環境配置**

### **Docker Compose配置**

#### **docker-compose.dev.yml結構**
```yaml
services:
  # 應用程式容器
  app-dev:
    build: 
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "8080:8080"  # 應用程式端口
      - "5005:5005"  # 除錯端口
    environment:
      - SPRING_PROFILES_ACTIVE=dev
    depends_on:
      - postgres

  # PostgreSQL資料庫
  postgres:
    image: postgres:17
    environment:
      POSTGRES_DB: library
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
```

### **Dockerfile.dev解析**
```dockerfile
# 基礎映像：Maven + OpenJDK 17
FROM maven:3.9-openjdk-17

# 設定工作目錄
WORKDIR /app

# 複製pom.xml並下載依賴
COPY pom.xml .
RUN mvn dependency:go-offline

# 複製原始碼
COPY src ./src

# 暴露端口
EXPOSE 8080 5005

# 開發模式命令
CMD ["mvn", "spring-boot:run", "-Dspring-boot.run.jvmArguments='-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005'"]
```

---

## 🚀 **啟動Docker環境**

### **命令說明**
```bash
docker-compose -f docker-compose.dev.yml up --build
```

**參數解釋：**
- `-f docker-compose.dev.yml`：指定使用開發環境配置
- `up`：啟動所有服務
- `--build`：重新建置映像

### **啟動流程**
1. **建置應用程式映像**：根據Dockerfile.dev建置
2. **啟動PostgreSQL**：建立資料庫容器
3. **啟動應用程式**：在容器中運行Spring Boot
4. **初始化資料庫**：執行database_schema.sql

### **訪問地址**
- **應用程式**：http://localhost:8080/api
- **API文件**：http://localhost:8080/api/swagger-ui.html
- **資料庫管理**：http://localhost:5050 (pgAdmin)

---

## 📊 **專案目錄結構**

```
library-system/
├── 📚 docs/                          # 文件資料夾
├── 🔧 src/                           # 原始碼目錄
│   ├── main/                         # 主要程式碼
│   │   ├── java/                     # Java原始碼
│   │   │   └── com/library/          # 基礎套件
│   │   │       └── LibraryManagementApplication.java
│   │   └── resources/                # 資源檔案
│   │       └── application.yml       # 應用程式配置
│   └── test/                         # 測試程式碼
├── 🗄️ database_schema.sql            # 資料庫Schema
├── 🐳 Dockerfile.dev                 # 開發環境Dockerfile
├── 🐳 docker-compose.dev.yml         # Docker Compose配置
├── 📦 pom.xml                        # Maven配置
└── 📖 README.md                      # 專案說明
```

---

## ✅ **階段0完成檢查清單**

- [x] **pom.xml建立**：包含所有必要依賴
- [x] **主應用程式類別**：Spring Boot入口點
- [x] **應用程式配置**：資料庫、JWT等設定
- [x] **Docker環境配置**：開發環境準備
- [x] **專案目錄結構**：標準Spring Boot結構

---

## 🎯 **學習重點總結**

### **1. Spring Boot自動配置**
- 根據依賴自動配置應用程式
- 減少手動配置的工作量
- 提供生產就緒的功能

### **2. Maven依賴管理**
- 自動下載和管理套件
- 解決版本衝突
- 標準化專案結構

### **3. Docker容器化**
- 環境一致性
- 快速部署
- 隔離性開發環境

### **4. 配置管理**
- 使用YAML格式配置
- 環境特定配置
- 外部化配置

---

## 🔄 **下一步：資料庫層開發**

接下來我們將：
1. **建立Entity類別**：對應資料庫表的Java物件
2. **建立Repository介面**：資料庫操作方法
3. **測試資料庫連線**：確保環境正常運作

---

**這個階段建立了專案的基礎架構，為後續開發奠定了堅實的基礎！**
