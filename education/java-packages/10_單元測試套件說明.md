# å–®å…ƒæ¸¬è©¦å¥—ä»¶èªªæ˜
## Unit Testing Packages Documentation

---

### ğŸ“‹ **ç›®éŒ„**
1. [JUnit 5 å¥—ä»¶](#junit-5-å¥—ä»¶)
2. [Mockito å¥—ä»¶](#mockito-å¥—ä»¶)
3. [Spring Boot Test å¥—ä»¶](#spring-boot-test-å¥—ä»¶)
4. [H2 Database å¥—ä»¶](#h2-database-å¥—ä»¶)
5. [JaCoCo å¥—ä»¶](#jacoco-å¥—ä»¶)
6. [æ¸¬è©¦è¨»è§£èªªæ˜](#æ¸¬è©¦è¨»è§£èªªæ˜)
7. [å¸¸ç”¨æ–·è¨€æ–¹æ³•](#å¸¸ç”¨æ–·è¨€æ–¹æ³•)

---

## ğŸ§ª **JUnit 5 å¥—ä»¶**

### **æ ¸å¿ƒåŠŸèƒ½**
JUnit 5 æ˜¯ Java çš„æ¨™æº–æ¸¬è©¦æ¡†æ¶ï¼Œæä¾›æ¸¬è©¦åŸ·è¡Œã€æ–·è¨€å’Œæ¸¬è©¦ç”Ÿå‘½é€±æœŸç®¡ç†ã€‚

### **ä¸»è¦å¥—ä»¶**
```java
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Nested;
import org.junit.jupiter.api.RepeatedTest;
import org.junit.jupiter.api.ParameterizedTest;
import org.junit.jupiter.api.ValueSource;
import org.junit.jupiter.api.extension.ExtendWith;
```

### **ç”Ÿå‘½é€±æœŸè¨»è§£**
```java
@BeforeAll
static void setUpAll() {
    // åœ¨æ‰€æœ‰æ¸¬è©¦å‰åŸ·è¡Œä¸€æ¬¡
}

@BeforeEach
void setUp() {
    // åœ¨æ¯å€‹æ¸¬è©¦å‰åŸ·è¡Œ
}

@AfterEach
void tearDown() {
    // åœ¨æ¯å€‹æ¸¬è©¦å¾ŒåŸ·è¡Œ
}

@AfterAll
static void tearDownAll() {
    // åœ¨æ‰€æœ‰æ¸¬è©¦å¾ŒåŸ·è¡Œä¸€æ¬¡
}
```

### **æ¸¬è©¦è¨»è§£**
```java
@Test
@DisplayName("æ¸¬è©¦ä½¿ç”¨è€…è¨»å†ŠæˆåŠŸ")
void testRegisterUser_Success() {
    // æ¸¬è©¦é‚è¼¯
}

@RepeatedTest(3)
void testRepeatedTest() {
    // é‡è¤‡åŸ·è¡Œ 3 æ¬¡
}

@ParameterizedTest
@ValueSource(strings = {"test1", "test2", "test3"})
void testParameterized(String input) {
    // åƒæ•¸åŒ–æ¸¬è©¦
}
```

---

## ğŸ­ **Mockito å¥—ä»¶**

### **æ ¸å¿ƒåŠŸèƒ½**
Mockito æ˜¯ç”¨æ–¼å»ºç«‹ Mock ç‰©ä»¶çš„æ¡†æ¶ï¼Œç”¨æ–¼æ¨¡æ“¬ä¾è³´å’Œé©—è­‰äº’å‹•ã€‚

### **ä¸»è¦å¥—ä»¶**
```java
import org.mockito.Mock;
import org.mockito.InjectMocks;
import org.mockito.MockitoAnnotations;
import org.mockito.junit.jupiter.MockitoExtension;
import static org.mockito.Mockito.*;
import static org.mockito.ArgumentMatchers.*;
```

### **Mock å»ºç«‹**
```java
// æ–¹æ³• 1: ä½¿ç”¨ @Mock è¨»è§£
@Mock
private UserRepository userRepository;

// æ–¹æ³• 2: ä½¿ç”¨ Mockito.mock()
UserRepository userRepository = Mockito.mock(UserRepository.class);

// æ–¹æ³• 3: ä½¿ç”¨ MockitoAnnotations
@BeforeEach
void setUp() {
    MockitoAnnotations.openMocks(this);
}
```

### **Mock è¡Œç‚ºè¨­å®š**
```java
// åŸºæœ¬å›å‚³å€¼
when(userRepository.findById(1L)).thenReturn(Optional.of(user));

// åƒæ•¸åŒ¹é…å™¨
when(userRepository.findByEmail(anyString())).thenReturn(Optional.of(user));
when(userRepository.save(any(User.class))).thenReturn(user);

// æ‹‹å‡ºä¾‹å¤–
when(userRepository.findById(999L))
    .thenThrow(new RuntimeException("User not found"));

// Void æ–¹æ³•
doNothing().when(userRepository).delete(user);

// é€£çºŒå‘¼å«ä¸åŒå›å‚³å€¼
when(userRepository.findById(1L))
    .thenReturn(Optional.of(user1))
    .thenReturn(Optional.of(user2));
```

### **åƒæ•¸åŒ¹é…å™¨**
```java
// åŸºæœ¬åŒ¹é…å™¨
any()           // ä»»ä½•ç‰©ä»¶
anyString()     // ä»»ä½•å­—ä¸²
anyInt()        // ä»»ä½•æ•´æ•¸
anyLong()       // ä»»ä½•é•·æ•´æ•¸
anyBoolean()    // ä»»ä½•å¸ƒæ—å€¼
anyList()       // ä»»ä½•åˆ—è¡¨
anyMap()        // ä»»ä½•æ˜ å°„

// ç‰¹å®šåŒ¹é…å™¨
eq("value")     // ç­‰æ–¼ç‰¹å®šå€¼
argThat()       // è‡ªå®šç¾©åŒ¹é…å™¨
isNull()        // ç©ºå€¼
isNotNull()     // éç©ºå€¼
contains("text") // åŒ…å«æ–‡å­—
```

### **é©—è­‰æ–¹æ³•**
```java
// åŸºæœ¬é©—è­‰
verify(userRepository).findById(1L);

// é©—è­‰å‘¼å«æ¬¡æ•¸
verify(userRepository, times(1)).findById(1L);
verify(userRepository, never()).delete(any());
verify(userRepository, atLeastOnce()).save(any());
verify(userRepository, atMost(3)).findAll();

// é©—è­‰åƒæ•¸
verify(userRepository).save(argThat(user -> 
    user.getName().equals("John Doe")
));

// é©—è­‰äº’å‹•é †åº
InOrder inOrder = inOrder(userRepository);
inOrder.verify(userRepository).findById(1L);
inOrder.verify(userRepository).save(any());
```

---

## ğŸŒ± **Spring Boot Test å¥—ä»¶**

### **æ ¸å¿ƒåŠŸèƒ½**
Spring Boot Test æä¾› Spring æ‡‰ç”¨ç¨‹å¼çš„æ¸¬è©¦æ”¯æ´ï¼ŒåŒ…æ‹¬æ•´åˆæ¸¬è©¦å’Œå–®å…ƒæ¸¬è©¦ã€‚

### **ä¸»è¦å¥—ä»¶**
```java
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.request.MockHttpServletRequestBuilder;
import org.springframework.test.web.servlet.result.MockMvcResultMatchers;
```

### **æ¸¬è©¦è¨»è§£**
```java
// å®Œæ•´ Spring æ‡‰ç”¨ç¨‹å¼æ¸¬è©¦
@SpringBootTest
class FullApplicationTest {
    // è¼‰å…¥å®Œæ•´çš„ Spring æ‡‰ç”¨ç¨‹å¼
}

// Web å±¤æ¸¬è©¦
@WebMvcTest(UserController.class)
class UserControllerTest {
    // åªè¼‰å…¥ Web å±¤ç›¸é—œçš„ Bean
}

// è³‡æ–™åº«å±¤æ¸¬è©¦
@DataJpaTest
class UserRepositoryTest {
    // åªè¼‰å…¥ JPA ç›¸é—œçš„ Bean
}

// ä½¿ç”¨ç‰¹å®š Profile
@ActiveProfiles("test")
class ProfileTest {
    // ä½¿ç”¨ test profile çš„é…ç½®
}
```

### **MockMvc ä½¿ç”¨**
```java
@Autowired
private MockMvc mockMvc;

// GET è«‹æ±‚
mockMvc.perform(get("/users/1"))
    .andExpect(status().isOk())
    .andExpect(jsonPath("$.success").value(true));

// POST è«‹æ±‚
mockMvc.perform(post("/users")
    .contentType(MediaType.APPLICATION_JSON)
    .content("{\"name\":\"John\",\"email\":\"john@example.com\"}"))
    .andExpect(status().isCreated());

// å¸¶åƒæ•¸çš„è«‹æ±‚
mockMvc.perform(get("/users")
    .param("page", "0")
    .param("size", "10"))
    .andExpect(status().isOk());
```

### **JSON è·¯å¾‘é©—è­‰**
```java
// åŸºæœ¬è·¯å¾‘é©—è­‰
.andExpect(jsonPath("$.success").value(true))
.andExpect(jsonPath("$.data.id").value(1))
.andExpect(jsonPath("$.data.name").value("John Doe"))

// é™£åˆ—é©—è­‰
.andExpect(jsonPath("$.data").isArray())
.andExpect(jsonPath("$.data[0].id").value(1))
.andExpect(jsonPath("$.data").hasSize(3))

// å­˜åœ¨æ€§é©—è­‰
.andExpect(jsonPath("$.data").exists())
.andExpect(jsonPath("$.error").doesNotExist())

// é¡å‹é©—è­‰
.andExpect(jsonPath("$.data.id").isNumber())
.andExpect(jsonPath("$.data.name").isString())
```

---

## ğŸ—„ï¸ **H2 Database å¥—ä»¶**

### **æ ¸å¿ƒåŠŸèƒ½**
H2 æ˜¯è¼•é‡ç´šçš„è¨˜æ†¶é«”è³‡æ–™åº«ï¼Œå¸¸ç”¨æ–¼å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦ã€‚

### **ä¸»è¦å¥—ä»¶**
```java
import org.springframework.boot.test.autoconfigure.orm.jpa.TestEntityManager;
import org.springframework.boot.test.autoconfigure.orm.jpa.AutoConfigureTestDatabase;
import com.h2database.h2.H2Database;
```

### **é…ç½®è¨­å®š**
```yaml
# application-test.yml
spring:
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    driver-class-name: org.h2.Driver
    username: sa
    password: 
  
  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.H2Dialect
  
  h2:
    console:
      enabled: true
      path: /h2-console
```

### **TestEntityManager ä½¿ç”¨**
```java
@Autowired
private TestEntityManager entityManager;

// å»ºç«‹ä¸¦å„²å­˜å¯¦é«”
User user = new User("John Doe", "john@example.com");
User savedUser = entityManager.persistAndFlush(user);

// æŸ¥è©¢å¯¦é«”
User foundUser = entityManager.find(User.class, savedUser.getId());

// æ¸…ç†è³‡æ–™
entityManager.clear();
entityManager.flush();

// ç§»é™¤å¯¦é«”
entityManager.remove(user);
```

### **è³‡æ–™åº«æ¸¬è©¦ç¯„ä¾‹**
```java
@DataJpaTest
class UserRepositoryTest {
    
    @Autowired
    private TestEntityManager entityManager;
    
    @Autowired
    private UserRepository userRepository;
    
    @BeforeEach
    void setUp() {
        entityManager.clear();
    }
    
    @Test
    void testFindByEmail_Success() {
        // Arrange
        User user = new User("John Doe", "john@example.com");
        entityManager.persistAndFlush(user);
        
        // Act
        Optional<User> result = userRepository.findByEmail("john@example.com");
        
        // Assert
        assertTrue(result.isPresent());
        assertEquals("John Doe", result.get().getName());
    }
}
```

---

## ğŸ“Š **JaCoCo å¥—ä»¶**

### **æ ¸å¿ƒåŠŸèƒ½**
JaCoCo æ˜¯ Java ç¨‹å¼ç¢¼è¦†è“‹ç‡åˆ†æå·¥å…·ï¼Œæä¾›è©³ç´°çš„è¦†è“‹ç‡å ±å‘Šã€‚

### **Maven é…ç½®**
```xml
<plugin>
    <groupId>org.jacoco</groupId>
    <artifactId>jacoco-maven-plugin</artifactId>
    <version>0.8.11</version>
    <executions>
        <execution>
            <goals>
                <goal>prepare-agent</goal>
            </goals>
        </execution>
        <execution>
            <id>report</id>
            <phase>test</phase>
            <goals>
                <goal>report</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

### **åŸ·è¡ŒæŒ‡ä»¤**
```bash
# åŸ·è¡Œæ¸¬è©¦ä¸¦ç”¢ç”Ÿè¦†è“‹ç‡å ±å‘Š
mvn test jacoco:report

# åªç”¢ç”Ÿè¦†è“‹ç‡å ±å‘Š
mvn jacoco:report

# æª¢æŸ¥è¦†è“‹ç‡é–¾å€¼
mvn jacoco:check
```

### **è¦†è“‹ç‡å ±å‘Š**
- **ä½ç½®**: `target/site/jacoco/index.html`
- **å…§å®¹**:
  - è¡Œè¦†è“‹ç‡ (Line Coverage)
  - åˆ†æ”¯è¦†è“‹ç‡ (Branch Coverage)
  - è¤‡é›œåº¦åˆ†æ (Complexity)
  - æ–¹æ³•è¦†è“‹ç‡ (Method Coverage)
  - é¡åˆ¥è¦†è“‹ç‡ (Class Coverage)

---

## ğŸ·ï¸ **æ¸¬è©¦è¨»è§£èªªæ˜**

### **JUnit 5 è¨»è§£**
```java
@Test                    // æ¨™è¨˜æ¸¬è©¦æ–¹æ³•
@DisplayName("æè¿°")      // æä¾›æ¸¬è©¦æè¿°
@Disabled("åŸå› ")         // åœç”¨æ¸¬è©¦
@Tag("æ¨™ç±¤")             // æ¨™è¨˜æ¸¬è©¦åˆ†é¡
@RepeatedTest(3)         // é‡è¤‡åŸ·è¡Œæ¸¬è©¦
@ParameterizedTest       // åƒæ•¸åŒ–æ¸¬è©¦
@Nested                  // å·¢ç‹€æ¸¬è©¦é¡åˆ¥
```

### **Spring Boot è¨»è§£**
```java
@SpringBootTest          // å®Œæ•´æ‡‰ç”¨ç¨‹å¼æ¸¬è©¦
@WebMvcTest              // Web å±¤æ¸¬è©¦
@DataJpaTest             // è³‡æ–™åº«å±¤æ¸¬è©¦
@AutoConfigureTestDatabase // è‡ªå‹•é…ç½®æ¸¬è©¦è³‡æ–™åº«
@ActiveProfiles("test")  // ä½¿ç”¨ç‰¹å®š Profile
@DirtiesContext          // æ¨™è¨˜æœƒä¿®æ”¹ Spring ä¸Šä¸‹æ–‡
```

### **Mockito è¨»è§£**
```java
@Mock                    // å»ºç«‹ Mock ç‰©ä»¶
@InjectMocks             // æ³¨å…¥ Mock åˆ°è¢«æ¸¬è©¦ç‰©ä»¶
@Spy                     // å»ºç«‹ Spy ç‰©ä»¶ (éƒ¨åˆ† Mock)
@Captor                  // æ•ç²æ–¹æ³•åƒæ•¸
```

### **Spring Security è¨»è§£**
```java
@WithMockUser            // æ¨¡æ“¬ä½¿ç”¨è€…
@WithUserDetails         // æ¨¡æ“¬ä½¿ç”¨è€…è©³ç´°è³‡è¨Š
@WithAnonymousUser       // æ¨¡æ“¬åŒ¿åä½¿ç”¨è€…
@WithMockUser(roles = "ADMIN") // æŒ‡å®šè§’è‰²
```

---

## âœ… **å¸¸ç”¨æ–·è¨€æ–¹æ³•**

### **JUnit 5 æ–·è¨€**
```java
// åŸºæœ¬æ–·è¨€
assertEquals(expected, actual);
assertNotEquals(expected, actual);
assertTrue(condition);
assertFalse(condition);
assertNull(object);
assertNotNull(object);

// é™£åˆ—æ–·è¨€
assertArrayEquals(expected, actual);
assertArrayEquals(expected, actual, "message");

// é›†åˆæ–·è¨€
assertIterableEquals(expected, actual);
assertLinesMatch(expected, actual);

// ä¾‹å¤–æ–·è¨€
assertThrows(ExceptionClass.class, () -> {
    // æœƒæ‹‹å‡ºä¾‹å¤–çš„ç¨‹å¼ç¢¼
});

assertDoesNotThrow(() -> {
    // ä¸æœƒæ‹‹å‡ºä¾‹å¤–çš„ç¨‹å¼ç¢¼
});

// è¶…æ™‚æ–·è¨€
assertTimeout(Duration.ofSeconds(5), () -> {
    // åœ¨ 5 ç§’å…§å®Œæˆçš„ç¨‹å¼ç¢¼
});
```

### **Hamcrest æ–·è¨€**
```java
import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.Matchers.*;

// åŸºæœ¬åŒ¹é…å™¨
assertThat(actual, is(expected));
assertThat(actual, equalTo(expected));
assertThat(actual, not(equalTo(expected)));

// å­—ä¸²åŒ¹é…å™¨
assertThat(actual, containsString("text"));
assertThat(actual, startsWith("prefix"));
assertThat(actual, endsWith("suffix"));
assertThat(actual, matchesPattern("regex"));

// æ•¸å€¼åŒ¹é…å™¨
assertThat(actual, greaterThan(10));
assertThat(actual, lessThan(100));
assertThat(actual, between(1, 10));

// é›†åˆåŒ¹é…å™¨
assertThat(actual, hasSize(3));
assertThat(actual, contains("item1", "item2"));
assertThat(actual, hasItem("item"));
assertThat(actual, empty());
```

### **Mockito æ–·è¨€**
```java
// é©—è­‰æ–¹æ³•å‘¼å«
verify(mock).method();
verify(mock, times(1)).method();
verify(mock, never()).method();
verify(mock, atLeastOnce()).method();
verify(mock, atMost(3)).method();

// é©—è­‰åƒæ•¸
verify(mock).method(eq("expected"));
verify(mock).method(anyString());
verify(mock).method(argThat(arg -> arg.equals("expected")));

// é©—è­‰äº’å‹•é †åº
InOrder inOrder = inOrder(mock);
inOrder.verify(mock).method1();
inOrder.verify(mock).method2();
```

---

## ğŸ”§ **æœ€ä½³å¯¦è¸**

### **æ¸¬è©¦å‘½å**
```java
// æ ¼å¼: testMethodName_Scenario
void testRegisterUser_Success()
void testRegisterUser_EmailAlreadyExists()
void testRegisterUser_InvalidPassword()
void testGetUserById_NotFound()
void testUpdateUser_AccessDenied()
```

### **æ¸¬è©¦çµæ§‹**
```java
@Test
void testMethodName_Scenario() {
    // Arrange - æº–å‚™æ¸¬è©¦è³‡æ–™
    User user = new User("John Doe", "john@example.com");
    when(userRepository.save(any())).thenReturn(user);
    
    // Act - åŸ·è¡Œè¢«æ¸¬è©¦æ–¹æ³•
    User result = userService.createUser(user);
    
    // Assert - é©—è­‰çµæœ
    assertNotNull(result);
    assertEquals("John Doe", result.getName());
    verify(userRepository).save(user);
}
```

### **æ¸¬è©¦éš”é›¢**
```java
@BeforeEach
void setUp() {
    // æ¸…ç†ç‹€æ…‹
    entityManager.clear();
    reset(userRepository);
}
```

### **æ¸¬è©¦è³‡æ–™ç®¡ç†**
```java
// ä½¿ç”¨ @BeforeEach å»ºç«‹æ¸¬è©¦è³‡æ–™
@BeforeEach
void setUp() {
    testUser = new User("John Doe", "john@example.com");
    testRole = new Role("MEMBER");
}

// ä½¿ç”¨æ¸¬è©¦å·¥å» æ–¹æ³•
private User createTestUser(String name, String email) {
    return new User(name, email);
}
```

---

**ç‹€æ…‹**: âœ… **å®Œæˆ** - å–®å…ƒæ¸¬è©¦å¥—ä»¶èªªæ˜æ–‡ä»¶å·²å»ºç«‹
