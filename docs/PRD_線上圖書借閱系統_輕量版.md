# 產品需求文件 (PRD) - 輕量版
## 線上圖書借閱系統 - 面試前測作品

---

### 文件資訊
- **專案名稱**: 線上圖書借閱系統
- **技術棧**: Java + Spring Boot
- **版本**: 1.0.0
- **開發時程**: 2天
- **專案類型**: 面試前測作品

---

## 1. 專案概述

### 1.1 專案背景
開發一個簡單的線上圖書借閱系統，實現基本的會員管理、書籍管理和借閱還書功能。作為面試前測作品，重點在於展示Spring Boot開發能力和程式碼品質。

### 1.2 專案目標
- 實現基本的圖書借閱功能
- 展示Spring Boot開發技能
- 提供可運行的完整系統
- 程式碼可編譯、可運行

### 1.3 目標使用者
- **館員 (Librarian)**: 可管理書籍資料
- **一般用戶 (Member)**: 可查詢書籍、借閱還書

---

## 2. 功能需求

### 2.1 會員管理系統

#### 2.1.1 使用者角色
| 角色 | 權限 |
|------|------|
| **館員 (Librarian)** | 管理書籍資料 |
| **一般用戶 (Member)** | 查詢書籍、借閱還書 |

#### 2.1.2 註冊功能
- **一般用戶註冊**:
  - 必填欄位：姓名、電子郵件、密碼
  - 密碼驗證（至少6位）
  - 電子郵件格式驗證

- **館員註冊**:
  - 除一般用戶欄位外，需提供館員識別碼
  - 需與外部系統驗證館員身份
  - 驗證API規格：
    ```
    Method: GET
    URL: https://todo.com.tw
    Headers: { "Authorization": "todo" }
    ```
  - 驗證成功後方可建立館員帳號

#### 2.1.3 登入功能
- 支援電子郵件登入
- 密碼加密儲存
- 登入成功後產生JWT Token

#### 2.1.4 權限控制
- 館員可新增/修改/刪除書籍
- 一般用戶只能查詢書籍和借閱還書

### 2.2 書籍管理系統

#### 2.2.1 書籍資訊
```json
{
  "id": "書籍ID",
  "title": "書名",
  "author": "作者",
  "publishYear": "出版年份",
  "type": "圖書/書籍",
  "copies": [
    {
      "id": "副本ID",
      "libraryId": "館別ID",
      "status": "可用/借出"
    }
  ]
}
```

#### 2.2.2 館員功能
- **新增書籍**: 支援多館館藏與同館多副本
- **修改書籍**: 更新書籍基本資訊
- **刪除書籍**: 軟刪除（標記為已刪除）

#### 2.2.3 搜尋功能
- **搜尋條件**:
  - 書名（模糊搜尋）
  - 作者（模糊搜尋）
  - 出版年份
  - 書籍類型

- **搜尋結果**:
  - 書籍基本資訊
  - 各館館藏數量（可用數量）

### 2.3 借閱與還書系統

#### 2.3.1 借閱規則
| 書籍類型 | 最大借閱數量 | 借閱期限 |
|----------|--------------|----------|
| **圖書** | 5本 | 30天 |
| **書籍** | 10本 | 30天 |

#### 2.3.2 借閱功能
- 檢查借閱資格（數量限制、逾期檢查）
- 更新館藏狀態
- 產生借閱記錄
- 借閱數量或期限超過規則時提示錯誤

#### 2.3.3 還書功能
- 更新館藏狀態
- 計算逾期費用（如有）
- 更新借閱記錄

#### 2.3.4 通知功能
- 借閱到期前5天發送通知
- 使用System.out.println模擬訊息發送
- 每日檢查並發送通知

---

## 3. 技術規格

### 3.1 技術棧
- **後端框架**: Spring Boot 3.x
- **程式語言**: Java 17+
- **資料庫**: PostgreSQL
- **容器化**: Docker
- **API文件**: Springdoc OpenAPI
- **測試框架**: JUnit 5
- **建置工具**: Maven

### 3.2 系統架構
```
┌─────────────────┐
│   REST API      │
└─────────┬───────┘
          │
┌─────────┴───────┐
│  Spring Boot    │
│  Application    │
│   (Docker)      │
└─────────┬───────┘
          │
┌─────────┴───────┐
│ PostgreSQL      │
│   (Docker)      │
└─────────────────┘
```

### 3.3 資料庫設計
- **users**: 使用者表
- **books**: 書籍表
- **book_copies**: 副本表
- **borrowings**: 借閱記錄表
- **libraries**: 館別表

---

## 4. API規格

### 4.1 認證API
```
POST /api/auth/register     - 使用者註冊
POST /api/auth/login        - 使用者登入
POST /api/auth/logout       - 使用者登出
```

### 4.2 書籍管理API
```
GET    /api/books           - 搜尋書籍
GET    /api/books/{id}      - 取得書籍詳情
POST   /api/books           - 新增書籍 (館員)
PUT    /api/books/{id}      - 更新書籍 (館員)
DELETE /api/books/{id}      - 刪除書籍 (館員)
```

### 4.3 借閱管理API
```
POST   /api/borrowings      - 借書
PUT    /api/borrowings/{id}/return - 還書
GET    /api/borrowings      - 查詢借閱記錄
```

### 4.4 API文件頁面
- **技術**: Springdoc OpenAPI 3
- **訪問路徑**: http://localhost:8080/swagger-ui.html
- **API文件**: http://localhost:8080/v3/api-docs
- **功能**:
  - 互動式API文件
  - 線上API測試
  - 請求/回應範例
  - 認證機制說明

---

## 5. 開發時程

### 5.1 第一天
- **上午**: 專案初始化、資料庫設計、實體類別建立
- **下午**: 會員管理功能開發（註冊、登入、權限控制）

### 5.2 第二天
- **上午**: 書籍管理功能開發（CRUD、搜尋）
- **下午**: 借閱還書功能開發、通知功能、測試

### 5.2 交付物
- 完整的Spring Boot應用程式
- 可運行的系統
- **API文件頁面**（Springdoc OpenAPI）
- **完整的單元測試套件**
- **Docker Compose配置**
- **README文件**（包含運行說明）

---

## 6. 測試要求

### 6.1 基本測試
- **單元測試（服務層）**:
  - 使用JUnit 5 + Mockito
  - 測試覆蓋率目標：80%+
  - 測試所有業務邏輯
  - Mock外部依賴

- **API端點測試**:
  - 使用Spring Boot Test + TestRestTemplate
  - 測試所有REST API端點
  - 驗證HTTP狀態碼和回應格式
  - 測試權限控制

- **資料庫操作測試**:
  - 使用@DataJpaTest
  - 測試Repository層
  - 使用H2記憶體資料庫進行測試
  - 驗證資料完整性

### 6.2 功能測試
- 會員註冊登入流程
- 書籍管理流程
- 借閱還書流程

---

## 7. 部署要求

### 7.1 Docker容器化部署
- **PostgreSQL容器**:
  - 使用官方PostgreSQL Docker映像
  - 設定資料庫名稱、使用者、密碼
  - 掛載資料卷保存資料
  - 暴露5432端口
  - 提供資料庫初始化腳本

- **Spring Boot應用容器**:
  - 使用OpenJDK 17 Docker映像
  - 多階段建置（Maven建置 + 運行）
  - 暴露8080端口
  - 設定環境變數連接資料庫
  - 包含API文件頁面

- **Docker Compose配置**:
  - 定義服務依賴關係
  - 設定網路連接
  - 配置環境變數
  - 提供健康檢查
  - 支援本地開發環境
  - 一鍵啟動完整系統

### 7.2 本地運行
- 使用Docker Compose啟動完整系統
- 支援Maven建置
- 提供Dockerfile和docker-compose.yml
- 提供README文件說明運行方式

### 7.3 程式碼要求
- 程式碼可編譯
- 程式碼可運行
- 提供基本的錯誤處理
- 遵循Java編碼規範
- Docker容器可正常啟動

---

## 8. 成功標準

### 8.1 功能完整性
- ✅ 會員註冊登入功能正常
- ✅ 館員驗證API整合
- ✅ 書籍管理功能完整
- ✅ 借閱還書功能正常
- ✅ 到期通知功能（System.out.println）

### 8.2 技術標準
- ✅ 程式碼可編譯運行
- ✅ 基本錯誤處理
- ✅ API端點正常運作
- ✅ 資料庫操作正確
- ✅ Docker容器正常啟動
- ✅ PostgreSQL連接正常
- ✅ API文件頁面可訪問
- ✅ 單元測試通過率100%
- ✅ Docker Compose一鍵啟動

### 8.3 品質標準
- ✅ 程式碼結構清晰
- ✅ 遵循Spring Boot最佳實踐
- ✅ 基本的測試覆蓋
- ✅ 可讀性良好的程式碼

---

## 附錄

### A. 技術注意事項
- 使用Spring Boot 3.x
- 使用Java 17+
- 使用PostgreSQL資料庫
- 實現基本的JWT認證
- 使用Spring Data JPA
- 使用Docker容器化部署

### B. 面試重點
- Spring Boot開發能力
- RESTful API設計
- 資料庫設計和操作
- Docker容器化技術
- 程式碼品質和結構
- 問題解決能力

### C. 可選功能（時間允許時）
- 更完善的錯誤處理
- 更詳細的API文件
- 更多的測試案例
- 基本的前端介面
- Docker Compose完整配置
- 資料庫初始化腳本
