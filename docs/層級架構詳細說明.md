# Spring Boot å±¤ç´šæ¶æ§‹è©³ç´°èªªæ˜
## Entityã€Repositoryã€DTO èˆ‡ DAO æ¨¡å¼æ¯”è¼ƒ

---

## ğŸ—ï¸ **è©³ç´°å±¤ç´šèªªæ˜**

### **1. Entityå±¤ (å¯¦é«”é¡åˆ¥)**

#### **å®šç¾©**
- **Entity**: è³‡æ–™åº«è¡¨å°æ‡‰çš„Javaç‰©ä»¶
- **ä½ç½®**: `src/main/java/com/library/entity/`
- **è·è²¬**: å®šç¾©è³‡æ–™åº«è¡¨çµæ§‹å’Œé—œè¯é—œä¿‚

#### **ç¯„ä¾‹ï¼šUser.java**
```java
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "username", unique = true, nullable = false)
    private String username;
    
    @Column(name = "email", unique = true, nullable = false)
    private String email;
    
    @Column(name = "password", nullable = false)
    private String password;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "role_id")
    private Role role;
    
    // å»ºæ§‹å‡½å¼ã€Getter/Setterã€toStringç­‰
}
```

#### **Entityç‰¹é»**
- âœ… **JPAè¨»è§£**: ä½¿ç”¨`@Entity`, `@Table`, `@Column`ç­‰
- âœ… **è³‡æ–™åº«å°æ‡‰**: ç›´æ¥å°æ‡‰è³‡æ–™åº«è¡¨çµæ§‹
- âœ… **é—œè¯é—œä¿‚**: å®šç¾©è¡¨ä¹‹é–“çš„é—œè¯
- âœ… **é©—è­‰è¨»è§£**: å¯åŠ å…¥`@NotNull`, `@Size`ç­‰é©—è­‰

---

### **2. Repositoryå±¤ (è³‡æ–™å­˜å–å±¤)**

#### **å®šç¾©**
- **Repository**: è³‡æ–™åº«æ“ä½œçš„ä»‹é¢
- **ä½ç½®**: `src/main/java/com/library/repository/`
- **è·è²¬**: æä¾›è³‡æ–™åº«CRUDæ“ä½œå’Œè‡ªå®šç¾©æŸ¥è©¢

#### **ç¯„ä¾‹ï¼šUserRepository.java**
```java
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    
    // åŸºæœ¬CRUDæ“ä½œ (ç”±JpaRepositoryæä¾›)
    // save(), findById(), findAll(), delete() ç­‰
    
    // è‡ªå®šç¾©æŸ¥è©¢æ–¹æ³•
    Optional<User> findByUsername(String username);
    
    Optional<User> findByEmail(String email);
    
    List<User> findByRole(Role role);
    
    @Query("SELECT u FROM User u WHERE u.isVerified = true")
    List<User> findAllVerifiedUsers();
    
    @Query("SELECT COUNT(u) FROM User u WHERE u.role = :role")
    long countByRole(@Param("role") Role role);
    
    // è¤‡é›œæŸ¥è©¢
    @Query("SELECT u FROM User u " +
           "JOIN u.borrowRecords br " +
           "WHERE br.status = 'BORROWED' " +
           "AND br.dueAt < :date")
    List<User> findUsersWithOverdueBooks(@Param("date") LocalDateTime date);
}
```

#### **Repositoryç‰¹é»**
- âœ… **ä»‹é¢å®šç¾©**: ä¸éœ€è¦å¯¦ä½œï¼ŒSpring Data JPAè‡ªå‹•ç”Ÿæˆ
- âœ… **æ–¹æ³•å‘½å**: æ ¹æ“šæ–¹æ³•åè‡ªå‹•ç”ŸæˆSQL
- âœ… **è‡ªå®šç¾©æŸ¥è©¢**: ä½¿ç”¨`@Query`è¨»è§£
- âœ… **åˆ†é æ’åº**: æ”¯æ´`Pageable`å’Œ`Sort`
- âœ… **äº‹å‹™ç®¡ç†**: è‡ªå‹•è™•ç†è³‡æ–™åº«äº‹å‹™

---

### **3. DTOå±¤ (è³‡æ–™å‚³è¼¸ç‰©ä»¶)**

#### **å®šç¾©**
- **DTO**: Data Transfer Objectï¼Œç”¨æ–¼APIè«‹æ±‚/å›æ‡‰çš„è³‡æ–™çµæ§‹
- **ä½ç½®**: `src/main/java/com/library/dto/`
- **è·è²¬**: å®šç¾©APIçš„è¼¸å…¥è¼¸å‡ºæ ¼å¼ï¼Œèˆ‡Entityåˆ†é›¢

#### **ç¯„ä¾‹ï¼šUserDto.java**
```java
// è«‹æ±‚DTO
public class UserRegistrationRequest {
    @NotBlank(message = "ä½¿ç”¨è€…åç¨±ä¸èƒ½ç‚ºç©º")
    @Size(min = 3, max = 50, message = "ä½¿ç”¨è€…åç¨±é•·åº¦å¿…é ˆåœ¨3-50å­—å…ƒä¹‹é–“")
    private String username;
    
    @NotBlank(message = "é›»å­éƒµä»¶ä¸èƒ½ç‚ºç©º")
    @Email(message = "é›»å­éƒµä»¶æ ¼å¼ä¸æ­£ç¢º")
    private String email;
    
    @NotBlank(message = "å¯†ç¢¼ä¸èƒ½ç‚ºç©º")
    @Size(min = 6, message = "å¯†ç¢¼é•·åº¦è‡³å°‘6å­—å…ƒ")
    private String password;
    
    @NotBlank(message = "å§“åä¸èƒ½ç‚ºç©º")
    private String fullName;
    
    // Getter/Setter
}

// å›æ‡‰DTO
public class UserResponse {
    private Long id;
    private String username;
    private String email;
    private String fullName;
    private String roleName;
    private boolean isVerified;
    private LocalDateTime createdAt;
    
    // å»ºæ§‹å‡½å¼ã€Getter/Setter
}

// ç™»å…¥è«‹æ±‚DTO
public class LoginRequest {
    @NotBlank(message = "ä½¿ç”¨è€…åç¨±ä¸èƒ½ç‚ºç©º")
    private String username;
    
    @NotBlank(message = "å¯†ç¢¼ä¸èƒ½ç‚ºç©º")
    private String password;
    
    // Getter/Setter
}
```

#### **DTOç‰¹é»**
- âœ… **APIå°å‘**: å°ˆé–€ç‚ºAPIè¨­è¨ˆçš„è³‡æ–™çµæ§‹
- âœ… **å®‰å…¨æ€§**: ä¸æš´éœ²æ•æ„Ÿè³‡æ–™ï¼ˆå¦‚å¯†ç¢¼ï¼‰
- âœ… **é©—è­‰**: ä½¿ç”¨Bean Validationé€²è¡Œè¼¸å…¥é©—è­‰
- âœ… **ç‰ˆæœ¬æ§åˆ¶**: å¯ç¨ç«‹æ¼”é€²ï¼Œä¸å½±éŸ¿Entity
- âœ… **æ•ˆèƒ½**: åªå‚³è¼¸éœ€è¦çš„è³‡æ–™

---

## ğŸ”„ **è³‡æ–™æµç¨‹**

### **å®Œæ•´è³‡æ–™æµç¨‹ç¯„ä¾‹**
```
HTTPè«‹æ±‚ â†’ Controller â†’ DTO â†’ Service â†’ Repository â†’ Entity â†’ è³‡æ–™åº«
   â†“         â†“         â†“       â†“         â†“         â†“        â†“
APIæ ¼å¼   è«‹æ±‚è™•ç†   è³‡æ–™é©—è­‰  æ¥­å‹™é‚è¼¯   è³‡æ–™å­˜å–   è³‡æ–™æ˜ å°„   è³‡æ–™å„²å­˜
```

#### **å…·é«”ç¯„ä¾‹ï¼šä½¿ç”¨è€…è¨»å†Š**
```java
// 1. Controlleræ¥æ”¶è«‹æ±‚
@PostMapping("/register")
public ResponseEntity<UserResponse> register(@Valid @RequestBody UserRegistrationRequest request) {
    UserResponse response = userService.register(request);
    return ResponseEntity.ok(response);
}

// 2. Serviceè™•ç†æ¥­å‹™é‚è¼¯
@Service
public class UserService {
    public UserResponse register(UserRegistrationRequest request) {
        // é©—è­‰æ¥­å‹™è¦å‰‡
        if (userRepository.existsByEmail(request.getEmail())) {
            throw new EmailAlreadyExistsException();
        }
        
        // å»ºç«‹Entity
        User user = new User();
        user.setName(request.getName());
        user.setEmail(request.getEmail());
        user.setPassword(passwordEncoder.encode(request.getPassword()));
        
        // å„²å­˜åˆ°è³‡æ–™åº«
        User savedUser = userRepository.save(user);
        
        // è½‰æ›ç‚ºå›æ‡‰DTO
        return UserResponse.from(savedUser);
    }
}
```

---

## ğŸ¤” **ç‚ºä»€éº¼ä¸ä½¿ç”¨DAOæ¨¡å¼ï¼Ÿ**

### **DAO vs Repository æ¯”è¼ƒ**

#### **DAOæ¨¡å¼ (èˆŠå¼)**
```java
// DAOä»‹é¢
public interface UserDAO {
    void save(User user);
    User findById(Long id);
    List<User> findAll();
    void update(User user);
    void delete(Long id);
}

// DAOå¯¦ä½œ
public class UserDAOImpl implements UserDAO {
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    @Override
    public void save(User user) {
        String sql = "INSERT INTO users (name, email, password) VALUES (?, ?, ?)";
        jdbcTemplate.update(sql, user.getName(), user.getEmail(), user.getPassword());
    }
    
    @Override
    public User findById(Long id) {
        String sql = "SELECT * FROM users WHERE id = ?";
        return jdbcTemplate.queryForObject(sql, new UserRowMapper(), id);
    }
    
    // éœ€è¦æ‰‹å‹•å¯¦ä½œæ‰€æœ‰æ–¹æ³•...
}
```

#### **Repositoryæ¨¡å¼ (ç¾ä»£)**
```java
// Repositoryä»‹é¢
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    // è‡ªå‹•æä¾›æ‰€æœ‰åŸºæœ¬CRUDæ“ä½œ
    // åªéœ€è¦å®šç¾©è‡ªå®šç¾©æŸ¥è©¢æ–¹æ³•
    Optional<User> findByEmail(String email);
}
```

### **ç‚ºä»€éº¼Repositoryæ›´å¥½ï¼Ÿ**

#### **1. é–‹ç™¼æ•ˆç‡**
- âœ… **è‡ªå‹•ç”Ÿæˆ**: Spring Data JPAè‡ªå‹•å¯¦ä½œåŸºæœ¬CRUD
- âœ… **æ–¹æ³•å‘½å**: æ ¹æ“šæ–¹æ³•åè‡ªå‹•ç”ŸæˆSQL
- âœ… **æ¸›å°‘æ¨£æ¿ç¨‹å¼ç¢¼**: ä¸éœ€è¦æ‰‹å‹•å¯¦ä½œæ¯å€‹æ–¹æ³•

#### **2. å‹åˆ¥å®‰å…¨**
- âœ… **ç·¨è­¯æ™‚æª¢æŸ¥**: æ–¹æ³•åéŒ¯èª¤æœƒåœ¨ç·¨è­¯æ™‚ç™¼ç¾
- âœ… **IDEæ”¯æ´**: æ›´å¥½çš„è‡ªå‹•è£œå…¨å’Œé‡æ§‹æ”¯æ´

#### **3. åŠŸèƒ½è±å¯Œ**
- âœ… **åˆ†é æ’åº**: å…§å»ºæ”¯æ´
- âœ… **äº‹å‹™ç®¡ç†**: è‡ªå‹•è™•ç†
- âœ… **å¿«å–æ”¯æ´**: å®¹æ˜“æ•´åˆå¿«å–

#### **4. æ¸¬è©¦ä¾¿åˆ©**
- âœ… **Mockæ”¯æ´**: å®¹æ˜“é€²è¡Œå–®å…ƒæ¸¬è©¦
- âœ… **æ¸¬è©¦è³‡æ–™åº«**: æ”¯æ´H2ç­‰è¨˜æ†¶é«”è³‡æ–™åº«

---

## ğŸ“Š **å±¤ç´šè·è²¬ç¸½çµ**

| å±¤ç´š | è·è²¬ | ç¯„ä¾‹ | ç‰¹é» |
|------|------|------|------|
| **Entity** | è³‡æ–™åº«è¡¨å°æ‡‰ | `User.java` | JPAè¨»è§£ã€è³‡æ–™åº«å°æ‡‰ |
| **Repository** | è³‡æ–™åº«æ“ä½œ | `UserRepository.java` | è‡ªå‹•ç”Ÿæˆã€è‡ªå®šç¾©æŸ¥è©¢ |
| **DTO** | APIè³‡æ–™æ ¼å¼ | `UserDto.java` | é©—è­‰ã€å®‰å…¨æ€§ã€ç‰ˆæœ¬æ§åˆ¶ |
| **Service** | æ¥­å‹™é‚è¼¯ | `UserService.java` | æ¥­å‹™è¦å‰‡ã€äº‹å‹™ç®¡ç† |
| **Controller** | HTTPè™•ç† | `UserController.java` | è«‹æ±‚è™•ç†ã€å›æ‡‰æ ¼å¼åŒ– |

---

## ğŸ¯ **æœ€ä½³å¯¦è¸**

### **1. Entityè¨­è¨ˆ**
- ä½¿ç”¨JPAè¨»è§£å®šç¾©è¡¨çµæ§‹
- è¨­å®šé©ç•¶çš„é—œè¯é—œä¿‚
- åŠ å…¥å¿…è¦çš„é©—è­‰è¨»è§£

### **2. Repositoryè¨­è¨ˆ**
- ç¹¼æ‰¿JpaRepositoryç²å¾—åŸºæœ¬CRUD
- ä½¿ç”¨æœ‰æ„ç¾©çš„æ–¹æ³•å
- è¤‡é›œæŸ¥è©¢ä½¿ç”¨@Queryè¨»è§£

### **3. DTOè¨­è¨ˆ**
- ç‚ºä¸åŒAPIè¨­è¨ˆä¸åŒçš„DTO
- ä½¿ç”¨Bean Validationé€²è¡Œé©—è­‰
- é¿å…æš´éœ²æ•æ„Ÿè³‡æ–™

### **4. å±¤ç´šåˆ†é›¢**
- æ¯å±¤åªè² è²¬è‡ªå·±çš„è·è²¬
- é¿å…è·¨å±¤ç›´æ¥å­˜å–
- ä½¿ç”¨ä¾è³´æ³¨å…¥ç®¡ç†ä¾è³´

---

**é€™å°±æ˜¯ç¾ä»£Spring Bootå°ˆæ¡ˆçš„æ¨™æº–æ¶æ§‹ï¼Repositoryæ¨¡å¼æ¯”DAOæ›´é«˜æ•ˆã€æ›´å®‰å…¨ã€æ›´æ˜“ç¶­è­·ã€‚**
